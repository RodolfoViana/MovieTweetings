---
title: "BestMovie"
author: "Rodolfo Viana"
date: "20-10-2015"
output: html_document
---

Comparing the IMDB rating before a movie being named to the Oscar and after.

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
source("oscar-lib.R")

nominations <- read.csv("~/Projetos/MovieTweetings/Data/Oscar-Nominations.csv")
movies <- read.delim("~/Projetos/MovieTweetings/latest/newmovies.dat", header=FALSE)
movies_ratings <- read.delim("~/Projetos/MovieTweetings/latest/newratings.dat", header=FALSE)

colnames(movies) <- c("movie_id", "movie_title", "genre")
colnames(movies_ratings) <-  c("user_id", "movie_id", "rating", "rating_timestamp")

oscar_nominations_2013 = 1389830400
oscar_nominations_2014 = 1421280000

oscar_2013 <- mean_before_after(movies_ratings, 2013, oscar_nominations_2013, nominations)
oscar_2014 <- mean_before_after(movies_ratings, 2014, oscar_nominations_2014, nominations)

plot <- oscar_2013 %>%
  gather(type, ratings, ratings_before:ratings_after)

p <- ggplot(data=plot, aes(x= name, y=ratings, fill=type)) + 
  geom_bar(stat="identity", position=position_dodge()) + 
  labs(y='Ratings', x='Movies', title = "2013") + 
  theme_classic() + 
  theme(axis.ticks = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1), panel.background=element_blank()) +
  scale_fill_manual(values=c("#edf8b1", "#7fcdbb"))

p

plot <- oscar_2014 %>%
  gather(type, ratings, ratings_before:ratings_after)

p <- ggplot(data=plot, aes(x= name, y=ratings, fill=type)) + 
  geom_bar(stat="identity", position=position_dodge()) + 
  labs(y='Ratings', x='Movies', title = "2013") + 
  theme_classic() + 
  theme(axis.ticks = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1), panel.background=element_blank()) +
  scale_fill_manual(values=c("#edf8b1", "#7fcdbb")) 

p
```

```{r}
n = c(2, 3, 5) 
> s = c("aa", "bb", "cc") 
> b = c(TRUE, FALSE, TRUE) 
> df = data.frame(n, s, b)  
month <- c("Oct", "Nov", "Dec", "Jan", "Feb", "Mar", "Apr")
num <- c(1,2,3,4,5,6,7)
timestamp <- c(1381881600,1384560000,1387152000,1389830400,1392508800,1394928000,1397606400)
df = data.frame(month, num, timestamp)  

before_date <- movies_ratings  %>% 
    filter(rating_timestamp > 1381881600)
  
  group_before <- group_by(before_date, movie_id)
  
  before_mean <- summarise(group_before, mean(rating))
  colnames(before_oscar_mean) <- c("movie_id", "ratings_before")

```